---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import PostCard from '../../components/PostCard.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  
  const uniqueCategories = [...new Set(allPosts.map((post) => post.data.category))];

  return uniqueCategories.map((category) => {
    const filteredPosts = allPosts.filter((post) => post.data.category === category);
    return {
      params: { category },
      props: { posts: filteredPosts },
    };
  });
}

const { category } = Astro.params;
const { posts } = Astro.props;

const categoryNames = {
  'money': 'Деньги и Успех',
  'psychology': 'Психология Личности',
  'karma': 'Карма и Судьба',
  'relationships': 'Отношения и Любовь',
  'horoscope' : 'Зодиаки'
};

const pageTitle = categoryNames[category] || category;
---

<MainLayout title={`${pageTitle} | Блог`}>
    <Header/>
    <main class="container mx-auto px-4 py-12">

    <div class="mb-8 text-center">
        <a href="/blog" class="text-sm text-purple-500 hover:underline mb-2 block">← Назад ко всем статьям</a>
        <h1 class="text-3xl font-bold text-purple-900">Рубрика: {pageTitle}</h1>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {posts.map((post) => (
        // <article class="bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden border border-purple-100 flex flex-col h-full">
        //     <a href={`/blog/${post.slug}`} class="flex flex-col h-full">
        //     {post.data.image && (
        //         <div class="h-48 overflow-hidden">
        //         <img src={post.data.image} alt={post.data.title} class="w-full h-full object-cover hover:scale-105 transition-transform duration-500"/>
        //         </div>
        //     )}
        //     <div class="p-6 flex flex-col flex-grow">
        //         <h2 class="text-xl font-bold mb-3 text-gray-800">{post.data.title}</h2>
        //         <p class="text-gray-600 text-sm mb-4 line-clamp-3">{post.data.description}</p>
        //         <div class="mt-auto pt-4 text-purple-500 font-semibold">Читать →</div>
        //     </div>
        //     </a>
        // </article>
        <PostCard post={post}/>
        ))}
    </div>

    </main>
    <Footer/>
</MainLayout>