---
import { getCollection } from 'astro:content';
import MainLayout from '../../../layouts/MainLayout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';
import PostCard from '../../../components/PostCard.astro';
import { categoryNames } from '../../../data/categories';
import Pagination from '../../../components/Pagination.astro';

export async function getStaticPaths({ paginate }) {
  const allPosts = await getCollection('blog');
  const uniqueCategories = [...new Set(allPosts.map((post) => post.data.category))].filter(Boolean);

  return uniqueCategories.flatMap((category) => {
    const filteredPosts = allPosts
      .filter((post) => post.data.category === category)
      .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
    
    return paginate(filteredPosts, {
      params: { category },
      pageSize: 12,
    });
  });
}

const { category } = Astro.params;
const { page } = Astro.props;

const pageTitle = categoryNames[category] || category;
---

<MainLayout title={`${pageTitle} - Страница ${page.currentPage} | Блог`}>
    <Header/>
    <main class="container mx-auto px-4 py-12">

    <div class="mb-8 text-center">
        <a href="/blog/1" class="text-sm text-purple-500 hover:underline mb-2 block">← Назад ко всем статьям</a>
        <h1 class="text-3xl font-bold text-purple-900">Рубрика: {pageTitle}</h1>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {page.data.map((post) => (
            <PostCard post={post}/>
        ))}
    </div>

    <Pagination page={page} />

    </main>
    <Footer/>
</MainLayout>
