---
import MainLayout from '../../layouts/MainLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import zodiacs from '../../data/zodiacs.json';

  export async function getStaticPaths() {
  return zodiacs.map((sign) => ({
    params: { sign: sign.slug }, 
    props: { signData: sign },  
  }));
}

const getImageName = (slug) => {
    const map = { 'virgo': 'virgin', 'sagittarius': 'saggitarius', 'pisces': 'pieces' };
    return map[slug] || slug;
};
  const { signData } = Astro.props;

const nameToSlug = zodiacs.reduce((acc, item) => {
    acc[item.name] = item.slug;
    return acc;
}, {});

const getSignLinks = (str) => {
    if (!str) return [];
    return str.split(',').map(name => {
        const cleanName = name.trim(); // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
        return {
            name: cleanName,
            href: `/zodiac/${nameToSlug[cleanName] || ''}` // –ï—Å–ª–∏ –≤–¥—Ä—É–≥ –æ–ø–µ—á–∞—Ç–∫–∞, —Å—Å—ã–ª–∫–∞ –±—É–¥–µ—Ç –ø—É—Å—Ç–æ–π
        };
    });
};

const bestMatches = getSignLinks(signData.details.best_match);
const worstMatches = getSignLinks(signData.details.worst_match);

---
<MainLayout title={signData.seo_title} description={signData.seo_desc}>
    <Header />
    <main class="zodiac-single">
        <div class="container">
            <div class="zodiac-hero" style="text-align: center; margin-bottom: 50px;">
                <img 
                    src={`/assets/img/${getImageName(signData.slug)}.png`} 
                    srcset={`/assets/img/${getImageName(signData.slug)}_2x.png 2x`}
                    alt={signData.name}
                    style="width: 120px; height: 120px; margin-bottom: 20px;"
                />
                <h1 class="h1">{signData.name}</h1>
                <p style="font-size: 1.2rem; opacity: 0.7; margin-top: 10px;">{signData.dates}</p>
                
                <div class="tags" style="display: flex; justify-content: center; gap: 15px; margin-top: 20px;">
                    <span class="tag">Element: {signData.element}</span>
                    <span class="tag">Planet: {signData.planet}</span>
                </div>
            </div>
            <div class="zodiac-grid">
                <article class="main-content">
                    <h4 class="h4">–û–±—â–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞</h4>
                    <p>{signData.about}</p>
                    <div class="spacer spacer--40"></div>
                    <h4 class="h4">–ú—É–∂—á–∏–Ω–∞ {signData.name}</h4>
                    <p>{signData.man}</p>
     
                    <div class="spacer spacer--40"></div>
     
                    <h4 class="h4">–ñ–µ–Ω—â–∏–Ω–∞ {signData.name}</h4>
                    <p>{signData.woman}</p>
     
                    <div class="spacer spacer--40"></div>
     
                    <h4 class="h4">–õ—é–±–æ–≤—å –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è</h4>
                    <p>{signData.love}</p>
                    <div class="spacer spacer--40"></div>

                    <h4 class="h4">–ö–∞—Ä—å–µ—Ä–∞ –∏ –¥–µ–Ω—å–≥–∏ üí∞</h4>
                    <p>{signData.career}</p>

                    <div class="spacer spacer--40"></div>

                    <h4 class="h4">–ó–¥–æ—Ä–æ–≤—å–µ –∏ —Ç–æ–Ω—É—Å üçè</h4>
                    <p>{signData.health}</p>

                    <div class="spacer spacer--40"></div>

                    <h4 class="h4">–°–µ–∫—Å—É–∞–ª—å–Ω–æ—Å—Ç—å üî•</h4>
                    <p>{signData.sex}</p>
                    
                    <div class="spacer spacer--40"></div>

                    <h4 class="h4">–°–µ–º—å—è –∏ –¥–µ—Ç–∏ üë®‚Äçüë©‚Äçüëß‚Äçüë¶</h4>
                    <p>{signData.family}</p>
                </article>

                <aside class="zodiac-sidebar">
                    <div class="fact-card">
                        <h4 class="h4 zodiac-sidebar-sub">–ê—Å—Ç—Ä–æ-—Ñ–∞–∫—Ç—ã</h4>
                        <ul class="fact-list">
                            <li>
                                <strong>–ü–ª–∞–Ω–µ—Ç–∞:</strong> <span>{signData.details.ruling_planet}</span>
                            </li>
                            <li>
                                <strong>–ö–∞–º–µ–Ω—å:</strong> <span>{signData.details.lucky_stone}</span>
                            </li>
                            <li>
                                <strong>–¶–≤–µ—Ç–∞:</strong> <span>{signData.details.lucky_colors.join(', ')}</span>
                            </li>
                            <li>
                                <strong>–ß–∏—Å–ª–∞:</strong> <span>{signData.details.lucky_numbers.join(', ')}</span>
                            </li>
                            <li class="separator"></li>
                            <li class="good-match">
                                <strong>‚ù§Ô∏è –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:</strong>
                                <div class="links-wrapper">
                                    {bestMatches.map((link, index) => (
                                        <>
                                            <a href={link.href} class="zodiac-link good">{link.name}</a>
                                            {index < bestMatches.length - 1 && ", "}
                                        </>
                                    ))}
                                </div>
                            </li>
                            <li class="bad-match">
                                <strong>‚ö†Ô∏è –°–ª–æ–∂–Ω–æ —Å:</strong>
                                <div class="links-wrapper">
                                    {worstMatches.map((link, index) => (
                                        <>
                                            <a href={link.href} class="zodiac-link bad">{link.name}</a>
                                            {index < worstMatches.length - 1 && ", "}
                                        </>
                                    ))}
                                </div>
                            </li>
                        </ul>
                    </div>
                </aside>
            </div>
        </div>
    </main>
    <Footer/>
</MainLayout>
